
FJ与外设打交道 的部分。

## I/O特征

### 三种常见设备
- 字符设备
>串口，鼠标/键盘等

访问特征：以字节为单位顺序访问
i/o命令：get()、put()等，通常使用文件访问接口和语义

- 块设备
	- 存储设备 如磁盘驱动器、磁带驱动器、光驱等
	- 访问特征
		- 数据块为单位，均匀 数据量大
	- I/O命令
		- 文件系统接口/原始I/O（ 提高性能）
		- 内存 映射文件访问
- 网络设备
	- 与外界打交道 以太网 无线 蓝牙
	- 访问特征
		- 交互复杂 格式化报文交换 协议
	- I/O命令
		- send/receive 网络报文
		- 通过网络接口支持多种网络协议 封装
### 同步/异步 I/O
> cpu 与设备 的交互
- 阻塞i/o:wait 
	- 读数据时，进程将进入等待状态 直到数据读出
	- 写数据，进程进入等待状态 直到设备完成数据写入处理
		中断只是在返回的时候处理  图
- 非阻塞 i/o:don't wait
	- 立即从read或write系统调用返回，返回值为成功传输字节数。写了后 直接返回
	- read或write的传输字节数可能为0
- 异步i/o 结合两者 tell me later
	- 读数据时 使用指针标记好用户缓冲区，立即返回；稍后内核将填充缓冲区并通知用户
	- 写数据时，使用指针标记好用户缓冲区，立即返回；稍后内核将处理数据并通知用户 
	- 



## I/O 结构
### 一个例子
- 北桥
	- 高速
	- 内存
	- 显卡
- 南桥
	- i/o设备
	- 各种设备相连
	- 磁盘 网络
### cpu 与设备的链接
- 设备控制器
	- cpu与I/o设备间的接口
	- 向cpu提供特殊指令和寄存器
- i/o地址
	- cpu用来控制i/o硬件
	- 内存地址或段口号
		- i/o指令
		- 内存映射i/o
- cpu与设备的三种通信方式
	- 轮询、设备中断和DMA

### I/O 指令和内存映射I/O
- I/O 指令
	- 通过I/O端口号访问设备寄存器
	- 特殊的cpu指令
		- `out 0x21`
- 内存映射I/O
	- 设备的寄存器/存储被映射到内存物理地址空间中
	- 通过内存load/store指令完成I/O操作
	- MMU设置映射，硬件跳线或程序在启动时设置地址

### i/o系统内核结构
图

### i/o请求生存周期


## I/O 数据传输

性能 关注的问题

### cpu 与设备控制器的数据传输
- 程序控制I/O pio
		- 通过cpu的in/out或load/store传输所有数据
	- 特点
		- 硬件简单，编程容易
		- 消耗的cpu时间和数据量成正比
	- 适用于简单的 小型的设备I/O
- DMA 直接内存访问
	- 设备控制器可直接访问系统总线
	- 控制器直接与内存互相传输数据
	- 特点
		- 设备传输数据不影响cpu
		- 需要cpu参与设置 开始 结束
		- 适用于高吞吐量i/o

### 细化到磁盘


### 设备通知操作系统的机制
操作系统需要了解设备的状态
	i/o操作完成时间
	I/o操作遇到错误
两种方式
	cpu主动轮询
	设备中断
#### 轮询
- i/o设备在特定的状态寄存器中放置状态和错误信息
- 操作系统定期检测状态寄存器
- 特点
	- 简单
	- i/o操作频繁或不可预测时，开销大和延时长

#### 设备中断
- 交互过程
- 特点
	- 处理不可预测事件效果好


### 设备中断I/O处理流程


在执行一条指令后检查中断请求

--- 

具体的例子 磁盘；提高性能 访问效率 调度和缓存；