- **文件系统知识回顾**

- **文件系统存储内容**

- 文件和文件夹：文件系统主要存储两类东西，文件是将扇区组织成自由长度的结构，可采用链表、树、哈希表等形式；文件夹是对文件的分类索引，本身也是一种文件。

- 磁盘存储结构：假设每个文件是一个链表，整个磁盘上就存储着各式各样的链表，找到链表的表头即可串联起后面的所有内容。

- **文件系统的技巧**

- 树根存储：为节省搜索时间，文件系统将树根存储在磁盘的特定位置。

- 打开文件表：操作系统缓存了一张打开文件表，用于记录文件链表表头在磁盘中的位置，以减少查找时间。

- **打开文件表的问题及解决方法**

- 表的上限：打开文件表有上限，早期操作系统支持 256 或 1024 个文件，现在可根据内存大小扩展。

- 表满处理：当表满时，可采用扔掉长时间不用的文件句柄的方法，同时需要统计文件句柄的使用频率。

- 重复打开文件：重复打开同一个文件会创建多个打开表项，为避免这种情况，可复用已有的数据。

- 文件指针独立性：每个进程可以有自己独立的文件指针，操作系统设计者可决定进程是否允许有多个文件指针。

- **文件系统的锁和缓存**

- 文件锁：文件系统上的锁是建议锁，不是强制锁，Windows 和 Linux 系统在文件删除时的提示机制不同。

- 文件缓存：可在文件系统的内存中做 cache，将已读数据存储下来，以提高读取速度，但会出现写回延迟和读写放大等问题。

- **新存储介质 NVM**

- 文件系统接口：即使有了新的存储介质 NVM，也需要为其重新建立一套文件系统接口，以实现对现有二进制系统的兼容。

- 操作系统开发困难：在成熟的操作系统领域开发新系统困难，因为需要保留原有二进制程序的系统调用接口，否则应用程序需要重新适配。

- **磁盘性能提升**

- **磁盘访问时间分析**

- 寻道时间：磁头移动到目标磁道上空所需的时间，是影响磁盘性能的主要因素。

- 旋转延迟：磁头到达目标磁道上空后，等待目标扇区旋转到磁头下方所需的时间，平均约为半圈的旋转时间。

- 数据传输时间：将目标扇区的数据传输到内存所需的时间，由用户读取的数据量决定。

- **磁道调度方法**

- 先入先出（FIFO）：最简单的调度方法，但磁头移动频繁，效率较低。

- 短路径优先（SSTF）：选择距离当前磁头位置最近的磁道进行访问，可减少磁头移动距离，但可能导致磁头黏滞现象。

- 扫描算法（电梯算法）：磁头先沿着一个方向移动，处理完该方向上的所有请求后再掉头处理另一个方向的请求，可减少磁头掉头次数。

- 循环扫描法：只在一个方向上完成读写请求，到达最大磁道号后直接将磁头抬起到 0 号磁道，再进行下一轮循环。

- n 步扫描法：一次接收固定数量的请求，按照特定方法处理，处理过程中到来的新请求放入另一个队列等待，采用双缓冲机制。

- **RAID 系统**

- RAID 0：将用户数据切成块，均匀分布在多个磁盘上，实现数据的并行读写，提高磁盘读写速度。

- RAID 1：对 RAID 0 的数据进行原样复制，提供数据副本，提高数据的可靠性和读写带宽。

- RAID 2：将数据拆成比特存储在多个磁盘上，但由于磁盘操作效率低，该方案被废弃。

- RAID 3：通过数学运算减少数据存储冲突，用计算换存储，但按比特操作无意义。

- RAID 4：将条带化数据做异或运算放在最后一块盘上，可实现磁盘损坏修复和加速，但校验盘读写频繁，容易损坏。

- RAID 5：将校验和均匀分布在各个盘片上，负载均衡，可抵御一块盘片坏掉，是比较完善的方案。

- RAID 5 + 1：结合 RAID 5 和 RAID 1 的优点，提高数据的可靠性和读写效率。

- **资源回收利用**

- **资源回收的重要性**：国家意识到资源循环利用的重要性，成立了相关企业开展资源回收工作。

- **废旧物资的回收价值**

- 废旧电子产品：智能手机等废旧电子产品中的芯片触点和走线可能含有黄金、铜等贵金属，屏幕玻璃可溶解再利用。

- 废旧汽车：汽车上的钢材、铜等金属和纺织物、芯片等具有回收利用价值，但目前缺乏有效的拆解工具。

- **资源回收行业的问题**

- 信息化程度低：资源回收行业尚未实现信息化、数字化和现代化，可通过开发手机 APP 等方式提高回收效率。

- 人才招聘困难：回收行业在人们观念中形象不佳，导致招聘困难。

- **可执行程序加载**

- **可执行程序的存储和读取**

- 文件头：可执行程序的文件头用于标识文件类型，Linux 系统通过 ELF header 比对确定可执行文件，Windows 系统通过文件扩展名标识。

- 程序头表：程序头表记录了程序的虚拟地址空间排布，包括数据的起始位置、长度、权限等信息。

- 虚拟地址空间：编译器和操作系统约定了可执行程序的地址空间记录和读取方式，程序执行时根据程序头表构造虚拟地址空间。

- **传统 read 操作的问题**

- 启动慢：对于大型可执行程序，使用 read 操作将所有数据加载到内存中会导致启动过程漫长。

- 内存消耗大：由于操作系统的缓存机制，使用 read 操作读取数据会在内存中产生两份副本，增加内存消耗。

- **MMAP 函数的应用**

- 原理：MMAP 函数在进程的虚拟地址空间中创建一个映射，将对该地址空间的访问转换为对文件的访问，实现按需加载。

- 优点：MMAP 函数避免了数据的重复加载，减少了内存占用，提高了程序启动速度。

- 缓存机制：为解决 MMAP 操作的慢速问题，可在内核中创建一个配置 cache，将已读数据存储在 cache 中，下次访问时直接从 cache 中读取。

- **MMAP 操作的权限问题**

- 页的权限标识：MMAP 操作创建的页同时属于内核和用户空间，不同权限的地址访问该页会有不同的结果。

- 数据安全：物理内存上的数据没有权限标识和数据保护，攻击者可通过液氮冻结 DRAM 数据的方式读取内存中的数据。